---
layout: single
title: "연관관계 매핑 기초"
categories: StudyJPAbasic
toc: true
author_profile: true
sidebar:
    nav: "docs"
---
<br>

# 연관관계 매핑 기초
- 객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.

## 주의!!!
  ### 객체를 테이블에 맞추어 데이터 중심으로 모델링하면 협력 관계를 만들 수 없다.

- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.
-  객체는 참조를 사용해서 연관된 객체를 찾는다
- 테이블과 객체 사이에는 큰 간격이 존재한다.
<br>

# 단방향 연관관계
![13](/images/2022-08-27-Entity/13.png)

<br>

![15](/images/2022-08-27-Entity/15.png)


<br>

# 양방향 연관관계와 연관관계의 주인
![20](/images/2022-08-27-Entity/20.png)

<br>

## 연관관계의 주인과 mappedBy
- mappedBy = JPA의 멘탈붕괴 난이도
- 객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다

<br>

## 객체와 테이블이 관계를 맺는 차이
- 객체 연관관계 = 2개
- 회원 -> 팀 연관관계 1개(단방향)
- 팀 -> 회원 연관관계 1개(단방향)

<br>

- 테이블 연관관계 = 1개
- 회원 <-> 팀의 연관관계 1개(양방향)
  
<br>

![26](/images/2022-08-27-Entity/26.png)

<br>


![27](/images/2022-08-27-Entity/27.png)

<br>


![28](/images/2022-08-27-Entity/28.png)

<br>

## 연관관계의 주인
<br>

### 양방향 매핑 규칙
- 객체의 두 관계중 하나를 연관관계의 주인으로 지정
- 연관관계의 주인만이 외래 키를 관리(등록, 수정)
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 사용X
- 주인이 아니면 mappedBy 속성으로 주인 지정

<br>

## 누구를 주인으로?
![31](/images/2022-08-27-Entity/31.png)

<br>

## 양방향 연관관계 주의 - 실습
- 순수 객체 상태를 고려해 항상 양쪽에 값을 설정하자
- 연관관계 편의 메소드를 생성하자
- 양방향 매핑시 무한 루프를 조심하자(toString(),lombok.json생성 라이브러리)

<br>

## 양방향 매핑 정리
- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
- 양방향 매핑은 반대 방향으로 조회기능이 추가된 것
- JPQL에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 주로 하고 양방향은 필요할 때 추가해도 됨
- 연관관계의 주인은 외래 키의 위치를 기준으로 정해야함
